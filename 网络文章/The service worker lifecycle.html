<!DOCTYPE html>
<!-- saved from url=(0041)https://web.dev/service-worker-lifecycle/ -->
<html lang="en" data-user-theme="light"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta content="width=device-width,initial-scale=1.0" name="viewport"><script type="text/javascript" async="" src="./The service worker lifecycle_files/analytics.js"></script><script type="text/javascript" async="" src="./The service worker lifecycle_files/js"></script><script>window.applyThemeSetting=function(e){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",o=e||localStorage.getItem("user-color-scheme")||t,r=document.documentElement.getAttribute("data-user-theme");if(o){o!==r&&document.documentElement.setAttribute("data-user-theme",o);const e=document.querySelector("web-lighthouse-viewer article.lh-root");e&&e.classList.toggle("lh-dark","dark"===o)}},window.applyThemeSetting();</script><link href="./The service worker lifecycle_files/next.css" rel="stylesheet"><link as="font" crossorigin="anonymous" href="https://web.dev/fonts/material-icons/regular.woff2" rel="preload"><link as="font" crossorigin="anonymous" href="https://web.dev/fonts/google-sans/regular/latin.woff2" rel="preload"><link as="font" crossorigin="anonymous" href="https://web.dev/fonts/google-sans/bold/latin.woff2" rel="preload"><link href="https://web-dev.imgix.net/" rel="preconnect"><meta content="#fff" name="theme-color"><title>The service worker lifecycle</title><meta content="A deep-dive into the service worker lifecycle. " name="description"><link href="https://web.dev/service-worker-lifecycle/" rel="canonical"><meta content="The service worker lifecycle" itemprop="name"><meta content="A deep-dive into the service worker lifecycle. " itemprop="description"><meta content="https://web-dev.imgix.net/image/FNkVSAX8UDTTQWQkKftSgGe9clO2/uZ3hQS2EPrA9csOgkoXI.png?auto=format&amp;fit=max&amp;w=1200&amp;fm=auto" itemprop="image"><meta content="en_US" property="og:locale"><meta content="article" property="og:type"><meta content="https://web.dev/service-worker-lifecycle/" property="og:url"><meta content="web.dev" property="og:site_name"><meta content="The service worker lifecycle" property="og:title"><meta content="A deep-dive into the service worker lifecycle. " property="og:description"><meta content="https://web-dev.imgix.net/image/FNkVSAX8UDTTQWQkKftSgGe9clO2/uZ3hQS2EPrA9csOgkoXI.png?auto=format&amp;fit=max&amp;w=1200&amp;fm=auto" property="og:image"><meta property="og:image:alt"><meta content="javascript" property="tag"><meta content="install" property="tag"><meta content="offline" property="tag"><meta content="progressive-web-apps" property="tag"><meta content="service-worker" property="tag"><meta content="summary_large_image" name="twitter:card"><meta content="The service worker lifecycle" name="twitter:title"><meta content="A deep-dive into the service worker lifecycle. " name="twitter:description"><meta content="https://web-dev.imgix.net/image/FNkVSAX8UDTTQWQkKftSgGe9clO2/uZ3hQS2EPrA9csOgkoXI.png?auto=format&amp;fit=max&amp;w=1200&amp;fm=auto" name="twitter:image"><link data-title="web.dev feed" href="https://web.dev/feed.xml" rel="alternate" type="application/atom+xml"><meta content="jakearchibald" name="authors"><meta content="install,javascript,offline,progressive-web-apps,service-worker" name="tags"><link href="https://web.dev/manifest.webmanifest" rel="manifest"><link rel="shortcut icon" href="https://web.dev/images/favicon.ico"><link href="https://web.dev/images/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="https://web.dev/images/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="https://web.dev/images/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link color="#0054ff" href="https://web.dev/images/safari-pinned-tab.svg" rel="mask-icon"><script>function loadScript(e,d){const n=document.createElement("script");if(n.src=e,n.onload=()=>{document.dispatchEvent(new CustomEvent("scriptLoaded",{detail:{url:e}}))},d&&(n.type=d),"module"===d){n.async=!1;const d=document.createElement("link");d.rel="modulepreload",d.href=e,document.head.append(d),window.addEventListener("DOMContentLoaded",(()=>{document.head.append(n)}))}else document.head.append(n)}</script><script>loadScript("/js/app.js?v=fedf5fbe","module");let pageScripts=["/js/content.js"];document.addEventListener("scriptLoaded",(e=>{const t=e.detail.url.split("?")[0],p=pageScripts.indexOf(t);p>-1&&pageScripts.splice(p,1),0===pageScripts.length&&document.dispatchEvent(new CustomEvent("pageScriptsLoaded"))})),loadScript("/js/content.js?v=a119c9fc","module");</script><link rel="modulepreload" href="./The service worker lifecycle_files/app.js"><link rel="modulepreload" href="./The service worker lifecycle_files/content.js"><script>loadScript("https://shared-storage-demo-content-producer.web.app/paa/scripts/private-aggregation-test.js",null);</script><script src="./The service worker lifecycle_files/private-aggregation-test.js"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),window.dataLayer.push({user_agent:navigator.userAgent}),window.dataLayer.push({"gtm.blocklist":["html","d","jsm","j"]});</script><meta content="Ah3H7DwyoUUsaRQdSySa1hMCS/JFQn/VVmrQODVDnRJGH9mU/uG6G0Uhh+4atnFGAoiEwDq+r9TzCyBi7f7wRw4AAABfeyJvcmlnaW4iOiJodHRwczovL3dlYi5kZXY6NDQzIiwiZmVhdHVyZSI6IlNwZWN1bGF0aW9uUnVsZXNQcmVmZXRjaEZ1dHVyZSIsImV4cGlyeSI6MTY5NDEzMTE5OX0=" http-equiv="origin-trial"><script type="speculationrules">{"prerender":[{"source":"document","where":{"and":[{"href_matches":"/*\\?*#*","relative_to":"document"},{"not":{"href_matches":"/patterns/*\\?*#*","relative_to":"document"}}]},"eagerness":"moderate"}]}</script><script src="./The service worker lifecycle_files/app.js" type="module"></script><script src="./The service worker lifecycle_files/content.js" type="module"></script><script src="./The service worker lifecycle_files/gtm.js"></script><style type="text/css">share-action{display:inline-flex;align-items:center;gap:.5em;cursor:pointer;color:var(--color-mid-text)}share-action:hover{filter:invert(.05)}share-action svg{width:1em;height:1em;transform:translateY(-.05ex)}</style><style type="text/css">@keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes scaleup{0%{transform:scale(.8)}to{transform:scale(1)}}.web-modal{align-items:center;background:rgba(0,0,0,.32);bottom:0;display:flex;justify-content:center;left:0;opacity:0;overflow:auto;padding:1em;position:fixed;right:0;top:0;transition:visibility 0s .15s;visibility:hidden;z-index:275}.web-modal .web-modal__container{background:get-color("shades-light-bright");border-radius:10px;box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12);display:flex;flex-direction:column;margin:auto;max-height:100%;max-width:35em;min-height:20em;pointer-events:auto;width:26em}.web-modal .web-modal__header{border-bottom:1px solid transparent;margin:0;padding:1.5rem 1.5rem .5rem}.web-modal .web-modal__content{flex:1;overflow:auto;padding:0 1.5rem}.web-modal .web-modal__footer{border-top:1px solid transparent;display:grid;gap:.5rem;grid-template-columns:1fr auto;justify-items:end;padding:1rem}.web-modal .web-modal__button{height:44px}.web-modal[open]{opacity:1;transition:visibility 0s;visibility:visible}.web-modal[animatable]{animation:fadein 75ms linear reverse}.web-modal[animatable][open]{animation:fadein .15s linear}.web-modal[animatable][open] .web-modal__container{animation:scaleup .15s cubic-bezier(0,0,.2,1),fadein 75ms linear}.web-modal[overflow] .web-modal__footer,.web-modal[overflow] .web-modal__header{border-color:get-color("shades-gray-glare")}</style></head><body class="" youdao="bind"><web-snackbar-container><!---->
      <web-snackbar stacked=""><!----> <div class="web-snackbar__surface flow"><!--?lit$215705122$-->
      <div class="web-snackbar__label" role="status">
        web.dev uses cookies to deliver and enhance the quality of its services
        and to analyze traffic. If you agree, cookies are also used to serve
        advertising and to personalize the content and advertisements that you
        see.
        <a href="https://policies.google.com/technologies/cookies">
          Learn more.
        </a>
      </div>
      <div class="web-snackbar__actions cluster gutter-base">
        <button class="button button--action">
          Agree
        </button>
        <button class="button">No thanks</button>
      </div>
    </div> </web-snackbar>
    </web-snackbar-container><a class="skip-link button" data-type="primary" href="https://web.dev/service-worker-lifecycle/#main">Skip to content</a><web-header class="site-header" role="banner"> <div class="cluster gutter-base"><button class="icon-button tooltip color-core-text md:hidden-yes" aria-labelledby="menu-button-toolip" data-alignment="right" data-open-drawer-button="" role="tooltip"><svg viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg> <span class="tooltip__content" id="menu-button-tooltip">Open menu</span></button><a class="site-header__brand brand" href="https://web.dev/"> <svg viewBox="0 0 125 24" aria-label="web.dev" fill="currentColor" height="24" role="img" width="125" xmlns="http://www.w3.org/2000/svg"><path d="M0.625 19.9489C0.625 18.2638 1.99102 16.8977 3.67614 16.8977H19.9489C21.634 16.8977 23 18.2638 23 19.9489C23 21.634 21.634 23 19.9489 23H3.67614C1.99102 23 0.625 21.634 0.625 19.9489Z" fill="#66CCFF"></path><path d="M1.51866 1.51866C2.7102 0.327114 4.64208 0.327114 5.83361 1.51866L13.97 9.65503C15.1615 10.8466 15.1615 12.7784 13.97 13.97L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L7.13797 12.1721C7.33655 11.9735 7.33655 11.6515 7.13797 11.4529L1.51866 5.83361C0.327114 4.64208 0.327114 2.7102 1.51866 1.51866Z" clip-rule="evenodd" fill="#0066FF" fill-rule="evenodd"></path><path d="M11.0422 16.8977L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L2.41233 16.8977H11.0422Z" fill="#CC66FF"></path><path d="M19.9488 23C21.6339 23 23 21.634 23 19.9489C23 18.2638 21.6339 16.8977 19.9488 16.8977C18.2637 16.8977 16.8977 18.2638 16.8977 19.9489C16.8977 21.634 18.2637 23 19.9488 23Z" fill="#0066FF"></path><path d="M116.6 20.1H114.4L109.6 8.20005H112L115.5 17.4L119 8.20005H121.4L116.6 20.1V20.1ZM99.8 12.8H106.6C106.5 11.2 105.2 9.90005 103.2 9.90005C101.5 9.90005 100.2 11 99.8 12.8V12.8ZM103.4 20.5C99.9 20.5 97.4 17.8 97.4 14.2C97.4 10.6 99.9 7.90005 103.3 7.90005C106.8 7.90005 109.1 10.3 109.1 14.4V14.6H99.8C99.9 16.9 101.6 18.5 103.6 18.5C105 18.5 106.2 17.8 106.9 16.4L108.9 17.4C107.8 19.3 105.8 20.5 103.4 20.5V20.5ZM89.4 20.5C86.3 20.5 83.7 17.7 83.7 14.2C83.7 10.7 86.3 7.90005 89.4 7.90005C91.1 7.90005 92.7 8.70005 93.5 9.90005H93.6L93.5 8.30005V2.80005H95.7V20.1H93.6V18.5H93.5C92.6 19.7 91.1 20.5 89.4 20.5V20.5ZM89.7 18.5C91.9 18.5 93.5 16.8 93.5 14.2C93.5 11.7 91.9 9.90005 89.7 9.90005C87.6 9.90005 85.9 11.7 85.9 14.2C85.9 16.7 87.6 18.5 89.7 18.5ZM82.9 18.6C82.9 19.5 82.2 20.2001 81.2 20.2001C80.3 20.2001 79.5 19.4 79.5 18.6C79.5 17.7 80.3 17 81.2 17C82.2 17 82.9 17.7 82.9 18.6ZM72.4 18.5C74.5 18.5 76.2 16.7 76.2 14.2C76.2 11.7 74.5 9.90005 72.4 9.90005C70.2 9.90005 68.6 11.7 68.6 14.2C68.6 16.7 70.2 18.5 72.4 18.5ZM72.8 20.5C71.1 20.5 69.5 19.7 68.7 18.5H68.6V20.1H66.5V2.80005H68.7V8.30005L68.6 9.90005H68.7C69.5 8.70005 71 7.90005 72.8 7.90005C75.9 7.90005 78.5 10.7 78.5 14.2C78.4 17.7 75.9 20.5 72.8 20.5V20.5ZM55.4 12.8H62.2C62.1 11.2 60.8 9.90005 58.8 9.90005C57.1 9.90005 55.8 11 55.4 12.8V12.8ZM59 20.5C55.5 20.5 53 17.8 53 14.2C53 10.6 55.5 7.90005 58.9 7.90005C62.4 7.90005 64.7 10.3 64.7 14.4V14.6H55.4C55.5 16.9 57.2 18.5 59.2 18.5C60.6 18.5 61.7 17.8 62.5 16.4L64.5 17.4C63.4 19.3 61.4 20.5 59 20.5V20.5ZM52.7 8.30005L48.9 20.2001H46.6L43.6 11.1L40.7 20.2001H38.4L34.5 8.30005H36.8L39.4 17.3L42.3 8.30005H44.6L47.5 17.3L50.1 8.30005H52.7V8.30005Z" clip-rule="evenodd" fill-rule="evenodd"></path></svg> </a></div> <web-navigation-drawer type="standard" tabindex="-1"> <nav aria-label="main navigation" class="site-header__nav" data-drawer-container=""><a data-category="Site-Wide Custom Events" data-label="Tab: About" class="site-header__link" href="https://web.dev/about/"> About </a><a data-category="Site-Wide Custom Events" data-label="Tab: Blog" class="site-header__link" href="https://web.dev/blog/"> Blog </a><a data-category="Site-Wide Custom Events" data-label="Tab: Learn" class="site-header__link" href="https://web.dev/learn/"> Learn </a><a data-category="Site-Wide Custom Events" data-label="Tab: Explore" class="site-header__link" href="https://web.dev/explore/"> Explore </a><a data-category="Site-Wide Custom Events" data-label="Tab: Patterns" class="site-header__link" href="https://web.dev/patterns/"> Patterns </a><a data-category="Site-Wide Custom Events" data-label="Tab: Case Studies" class="site-header__link" href="https://web.dev/tags/case-study/"> Case studies </a><button class="icon-button tooltip color-core-text md:hidden-yes" data-drawer-close-button=""><svg viewBox="0 0 24 24" aria-label="close" class="icon" height="24" role="img" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> <span class="tooltip__content">Close</span></button></nav> <!----></web-navigation-drawer> <div class="site-header__actions cluster"><div class="site-header__search"><web-search i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}" results-id="search-main-results"><!---->
      <button class="web-search__open-btn icon-button color-mid-text" aria-label="Open search">
        <svg class="web-search__search-icon" xmlns="http://www.w3.org/2000/svg" height="24" width="24" aria-hidden="true">
          <path d="M0 0h24v24H0z" fill="none"></path>
          <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
        </svg>
      </button>
      <div class="web-search__input-wrapper" role="combobox" aria-controls="web-search__input" aria-haspopup="listbox" aria-expanded="false" aria-owns="search-main-results-list">
        <input id="web-search__input" class="web-search__input" type="text" role="searchbox" autocomplete="off" aria-autocomplete="list" aria-controls="search-main-results-list" aria-label="All articles" placeholder="Search">
      </div>
    </web-search><web-search-results id="search-main-results"><!---->
        <div role="listbox" aria-hidden="true" id="search-main-results-list"></div>
      </web-search-results></div></div> <!----></web-header><main id="main"><div class="banner bg-state-info-bg color-core-text" role="banner"><div class="banner__content flow">Thanks for tuning in to Google I/O. <a href="https://io.google/2023/program/?q=web-topic,web/&amp;utm_source=web&amp;utm_medium=embedded_marketing&amp;utm_campaign=hpp_ondemand_banner&amp;utm_content=">Watch the Chrome content on-demand.</a></div></div><div class="post wrapper" data-flush=""><div class="sidebar region flex-align-start flex-dir-rev flex-wrap-no"><nav aria-label="On this page" class="course__toc toc over-scroll hidden-yes lg:hidden-no" data-type="side"><div class="course-toc__heading font-google-sans weight-medium">On this page</div><web-scroll-spy> <div class="toc__wrapper flow-recursive"><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#the-intent">The intent</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#the-first-service-worker">The first service worker</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#scope-and-control">Scope and control</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#download,-parse,-and-execute">Download, parse, and execute</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#install">Install</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#activate">Activate</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#clientsclaim">clients.claim</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#updates">Updating the service worker</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#install-2">Install</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#waiting">Waiting</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#activate-2">Activate</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#skip-the-waiting-phase">Skip the waiting phase</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#manual-updates">Manual updates</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#avoid-url-change">Avoid changing the URL of your service worker script</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#devtools">Making development easy</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#update-on-reload">Update on reload</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#skip-waiting">Skip waiting</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#shift-reload">Shift-reload</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#handling-updates">Handling updates</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#the-lifecycle-goes-ever-on">The lifecycle goes ever on</a></li></ul></div> <!----></web-scroll-spy></nav><article class="prose legacy-rollout"><header class="flow gap-bottom-size-3"><h1>The service worker lifecycle</h1><div class="flow-space-size-1 color-mid-text text-size-0"><time>Sep 29, 2016</time> — Updated <time>Dec 5, 2018</time></div><div class="flow"><span class="post-signpost__title"> </span></div><div class="flow"><div class="flow post-signpost"><span class="post-signpost__title"> Appears in: </span><a class="post-signpost__link" href="https://web.dev/reliable/">Network reliability</a></div></div><div class="cluster flow-space-size-2"><div class="author"><a class="avatar" href="https://web.dev/authors/jakearchibald/"> <img alt="Jake Archibald" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" src="./The service worker lifecycle_files/Cprm03kLbFXkxbzGLI6x.jpg" srcset="https://web-dev.imgix.net/image/admin/Cprm03kLbFXkxbzGLI6x.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=1&amp;q=75 1x,     https://web-dev.imgix.net/image/admin/Cprm03kLbFXkxbzGLI6x.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=2&amp;q=50 2x,     https://web-dev.imgix.net/image/admin/Cprm03kLbFXkxbzGLI6x.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=3&amp;q=35 3x,     https://web-dev.imgix.net/image/admin/Cprm03kLbFXkxbzGLI6x.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=4&amp;q=23 4x,     https://web-dev.imgix.net/image/admin/Cprm03kLbFXkxbzGLI6x.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=5&amp;q=20 5x" decoding="async" height="64" loading="lazy" width="64"> </a><div class="flow"><cite class="author__name"> <a href="https://web.dev/authors/jakearchibald/">Jake Archibald</a> </cite><div class="author__links cluster"><a href="https://twitter.com/jaffathecake">Twitter</a><a href="https://jakearchibald.com/">Homepage</a></div></div></div></div></header><div class="lg:hidden-yes flow-space-size-1"><details aria-label="On this page" data-type="inner" role="navigation"><summary>On this page</summary> <div class="toc"><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#the-intent">The intent</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#the-first-service-worker">The first service worker</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#scope-and-control">Scope and control</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#download,-parse,-and-execute">Download, parse, and execute</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#install">Install</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#activate">Activate</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#clientsclaim">clients.claim</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#updates">Updating the service worker</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#install-2">Install</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#waiting">Waiting</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#activate-2">Activate</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#skip-the-waiting-phase">Skip the waiting phase</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#manual-updates">Manual updates</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#avoid-url-change">Avoid changing the URL of your service worker script</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#devtools">Making development easy</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#update-on-reload">Update on reload</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#skip-waiting">Skip waiting</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#shift-reload">Shift-reload</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#handling-updates">Handling updates</a></li><li class="toc__listitem"><a class="toc__anchor" href="https://web.dev/service-worker-lifecycle/#the-lifecycle-goes-ever-on">The lifecycle goes ever on</a></li></ul></div></details></div><p>The lifecycle of the service worker is its most complicated part. If you don't know what it's trying to do and what the benefits are, it can feel like it's fighting you. But once you know how it works, you can deliver seamless, unobtrusive updates to users, mixing the best of web and native patterns.</p><p>This is a deep dive, but the bullets at the start of each section cover most of what you need to know.</p><h2 id="the-intent">The intent <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#the-intent">#</a></h2><p>The intent of the lifecycle is to:</p><ul><li>Make offline-first possible.</li><li>Allow a new service worker to get itself ready without disrupting the current one.</li><li>Ensure an in-scope page is controlled by the same service worker (or no service worker) throughout.</li><li>Ensure there's only one version of your site running at once.</li></ul><p>That last one is pretty important. Without service workers, users can load one tab to your site, then later open another. This can result in two versions of your site running at the same time. Sometimes this is ok, but if you're dealing with storage you can easily end up with two tabs having very different opinions on how their shared storage should be managed. This can result in errors, or worse, data loss.</p><aside class="aside flow bg-state-bad-bg color-state-bad-text"><p class="cluster color-state-bad-text"><span class="aside__icon box-block"><svg aria-label="Error sign" viewBox="0 0 24 24" fill="currentColor" height="24" role="img" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-2h2v2h-2zm0-10v6h2V7h-2z" clip-rule="evenodd" fill-rule="evenodd"></path></svg></span><strong>Caution</strong></p><div class="flow">Users actively dislike data loss. It causes them great sadness.</div></aside><h2 id="the-first-service-worker">The first service worker <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#the-first-service-worker">#</a></h2><p>In brief:</p><ul><li>The <code>install</code> event is the first event a service worker gets, and it only happens once.</li><li>A promise passed to <code>installEvent.waitUntil()</code> signals the duration and success or failure of your install.</li><li>A service worker won't receive events like <code>fetch</code> and <code>push</code> until it successfully finishes installing and becomes "active".</li><li>By default, a page's fetches won't go through a service worker unless the page request itself went through a service worker. So you'll need to refresh the page to see the effects of the service worker.</li><li><code>clients.claim()</code> can override this default, and take control of non-controlled pages.</li></ul><figure><video autoplay="" controls="" loop="" muted=""><source src="https://storage.googleapis.com/web-dev-uploads/video/jL3OLOhcWUQDnR4XjewLBx4e3PC3/rdeulhDt9H1tqOdqh9Cj.mp4" type="video/mp4"></video></figure><p>Take this HTML:</p><web-copy-code><button class="button button__round web-copy-code__button" aria-label="Copy code"><span class="tooltip" role="tooltip" data-alignment="left"><span class="tooltip__content">Copy code</span></span></button><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><br>An image will appear here in 3 seconds:<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><br>  navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'SW registered!'</span><span class="token punctuation">,</span> reg<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Boo!'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'/dog.svg'</span><span class="token punctuation">;</span><br>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre> <!----></web-copy-code><p>It registers a service worker, and adds image of a dog after 3 seconds.</p><p>Here's its service worker, <code>sw.js</code>:</p><web-copy-code><button class="button button__round web-copy-code__button" aria-label="Copy code"><span class="tooltip" role="tooltip" data-alignment="left"><span class="tooltip__content">Copy code</span></span></button><pre class="language-js"><code class="language-js">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'V1 installing…'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// cache a cat SVG</span><br>  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><br>    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'static-v1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'/cat.svg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'V1 now ready to handle fetches!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// serve the cat SVG from the cache if the request is</span><br>  <span class="token comment">// same-origin and the path is '/dog.svg'</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin <span class="token operator">==</span> location<span class="token punctuation">.</span>origin <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/dog.svg'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/cat.svg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <!----></web-copy-code><p>It caches an image of a cat, and serves it whenever there's a request for <code>/dog.svg</code>. However, if you <a href="https://service-worker-lifecycle-demos.glitch.me/main/" rel="noopener">run the above example</a>, you'll see a dog the first time you load the page. Hit refresh, and you'll see the cat.</p><p>Note: Cats are better than dogs. They just <em>are</em>.</p><h3 id="scope-and-control">Scope and control <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#scope-and-control">#</a></h3><p>The default scope of a service worker registration is <code>./</code> relative to the script URL. This means if you register a service worker at <code>//example.com/foo/bar.js</code> it has a default scope of <code>//example.com/foo/</code>.</p><p>We call pages, workers, and shared workers <code>clients</code>. Your service worker can only control clients that are in-scope. Once a client is "controlled", its fetches go through the in-scope service worker. You can detect if a client is controlled via <code>navigator.serviceWorker.controller</code> which will be null or a service worker instance.</p><h3 id="download,-parse,-and-execute">Download, parse, and execute <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#download,-parse,-and-execute">#</a></h3><p>Your very first service worker downloads when you call <code>.register()</code>. If your script fails to download, parse, or throws an error in its initial execution, the register promise rejects, and the service worker is discarded.</p><p>Chrome's DevTools shows the error in the console, and in the service worker section of the application tab:</p><figure><img alt="Error displayed in service worker DevTools tab" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="./The service worker lifecycle_files/6IpquorXzgFFDcxAZRVk.png" srcset="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=200 200w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=228 228w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=260 260w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=296 296w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=338 338w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=385 385w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=439 439w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=500 500w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=571 571w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=650 650w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=741 741w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=845 845w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=964 964w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=1098 1098w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=1252 1252w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=1428 1428w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/6IpquorXzgFFDcxAZRVk.png?auto=format&amp;w=1600 1600w" decoding="async" height="438" loading="lazy" width="800"></figure><h3 id="install">Install <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#install">#</a></h3><p>The first event a service worker gets is <code>install</code>. It's triggered as soon as the worker executes, and it's only called once per service worker. If you alter your service worker script the browser considers it a different service worker, and it'll get its own <code>install</code> event. I'll cover <a href="https://web.dev/service-worker-lifecycle/#updates">updates in detail later</a>.</p><p>The <code>install</code> event is your chance to cache everything you need before being able to control clients. The promise you pass to <code>event.waitUntil()</code> lets the browser know when your install completes, and if it was successful.</p><p>If your promise rejects, this signals the install failed, and the browser throws the service worker away. It'll never control clients. This means we can't rely on <code>cat.svg</code> being present in the cache in our <code>fetch</code> events. It's a dependency.</p><h3 id="activate">Activate <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#activate">#</a></h3><p>Once your service worker is ready to control clients and handle functional events like <code>push</code> and <code>sync</code>, you'll get an <code>activate</code> event. But that doesn't mean the page that called <code>.register()</code> will be controlled.</p><p>The first time you load <a href="https://service-worker-lifecycle-demos.glitch.me/main/" rel="noopener">the demo</a>, even though <code>dog.svg</code> is requested long after the service worker activates, it doesn't handle the request, and you still see the image of the dog. The default is <em>consistency</em>, if your page loads without a service worker, neither will its subresources. If you load <a href="https://service-worker-lifecycle-demos.glitch.me/main/" rel="noopener">the demo</a> a second time (in other words, refresh the page), it'll be controlled. Both the page and the image will go through <code>fetch</code> events, and you'll see a cat instead.</p><h3 id="clientsclaim">clients.claim <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#clientsclaim">#</a></h3><p>You can take control of uncontrolled clients by calling <code>clients.claim()</code> within your service worker once it's activated.</p><p>Here's <a href="https://service-worker-lifecycle-demos.glitch.me/claimed/" rel="noopener">a variation of the demo above</a> which calls <code>clients.claim()</code> in its <code>activate</code> event. You <em>should</em> see a cat the first time. I say "should", because this is timing sensitive. You'll only see a cat if the service worker activates and <code>clients.claim()</code> takes effect before the image tries to load.</p><p>If you use your service worker to load pages differently than they'd load via the network, <code>clients.claim()</code> can be troublesome, as your service worker ends up controlling some clients that loaded without it.</p><aside class="aside flow bg-state-info-bg color-state-info-text"><div class="flow"><strong>Note:</strong> I see a lot of people including <code>clients.claim()</code> as boilerplate, but I rarely do so myself. It only really matters on the very first load, and due to progressive enhancement the page is usually working happily without service worker anyway.</div></aside><h2 id="updates">Updating the service worker <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#updates">#</a></h2><p>In brief:</p><ul><li>An update is triggered if any of the following happens: <ul><li>A navigation to an in-scope page.</li><li>A functional events such as <code>push</code> and <code>sync</code>, unless there's been an update check within the previous 24 hours.</li><li>Calling <code>.register()</code> <em>only if</em> the service worker URL has changed. However, you should <a href="https://web.dev/service-worker-lifecycle/#avoid-url-change">avoid changing the worker URL</a>.</li></ul></li><li>Most browsers, including <a href="https://developer.chrome.com/blog/fresher-sw/" rel="noopener">Chrome 68 and later</a>, default to ignoring caching headers when checking for updates of the registered service worker script. They still respect caching headers when fetching resources loaded inside a service worker via <code>importScripts()</code>. You can override this default behavior by setting the <a href="https://developers.google.com/web/updates/2018/06/fresher-sw/#updateviacache" rel="noopener"><code>updateViaCache</code></a> option when registering your service worker.</li><li>Your service worker is considered updated if it's byte-different to the one the browser already has. (We're extending this to include imported scripts/modules too.)</li><li>The updated service worker is launched alongside the existing one, and gets its own <code>install</code> event.</li><li>If your new worker has a non-ok status code (for example, 404), fails to parse, throws an error during execution, or rejects during install, the new worker is thrown away, but the current one remains active.</li><li>Once successfully installed, the updated worker will <code>wait</code> until the existing worker is controlling zero clients. (Note that clients overlap during a refresh.)</li><li><code>self.skipWaiting()</code> prevents the waiting, meaning the service worker activates as soon as it's finished installing.</li></ul><figure><video autoplay="" controls="" loop="" muted=""><source src="https://storage.googleapis.com/web-dev-uploads/video/jL3OLOhcWUQDnR4XjewLBx4e3PC3/5ipiSRfkCL45aglik4hK.mp4" type="video/mp4"></video></figure><p>Let's say we changed our service worker script to respond with a picture of a horse rather than a cat:</p><web-copy-code><button class="button button__round web-copy-code__button" aria-label="Copy code"><span class="tooltip" role="tooltip" data-alignment="left"><span class="tooltip__content">Copy code</span></span></button><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> expectedCaches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'static-v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'V2 installing…'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// cache a horse SVG into a new cache, static-v2</span><br>  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><br>    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'static-v2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'/horse.svg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token comment">// delete any caches that aren't in expectedCaches</span><br>  <span class="token comment">// which will get rid of static-v1</span><br>  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><br>    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">keys</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><br>      keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>expectedCaches<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'V2 now ready to handle fetches!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// serve the horse SVG from the cache if the request is</span><br>  <span class="token comment">// same-origin and the path is '/dog.svg'</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin <span class="token operator">==</span> location<span class="token punctuation">.</span>origin <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/dog.svg'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/horse.svg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <!----></web-copy-code><aside class="aside flow bg-state-info-bg color-state-info-text"><div class="flow"><strong>Note:</strong> I have no strong opinions on horses.</div></aside><p><a href="https://service-worker-lifecycle-demos.glitch.me/main/v2.html" rel="noopener">Check out a demo of the above</a>. You should still see an image of a cat. Here's why…</p><h3 id="install-2">Install <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#install-2">#</a></h3><p>Note that I've changed the cache name from <code>static-v1</code> to <code>static-v2</code>. This means I can set up the new cache without overwriting things in the current one, which the old service worker is still using.</p><p>This patterns creates version-specific caches, akin to assets a native app would bundle with its executable. You may also have caches that aren't version specific, such as <code>avatars</code>.</p><h3 id="waiting">Waiting <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#waiting">#</a></h3><p>After it's successfully installed, the updated service worker delays activating until the existing service worker is no longer controlling clients. This state is called "waiting", and it's how the browser ensures that only one version of your service worker is running at a time.</p><p>If you ran <a href="https://service-worker-lifecycle-demos.glitch.me/main/v2.html" rel="noopener">the updated demo</a>, you should still see a picture of a cat, because the V2 worker hasn't yet activated. You can see the new service worker waiting in the "Application" tab of DevTools:</p><figure><img alt="DevTools showing new service worker waiting" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="./The service worker lifecycle_files/x5RaAqvkC5QOjRWyEVv0.png" srcset="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=200 200w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=228 228w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=260 260w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=296 296w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=338 338w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=385 385w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=439 439w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=500 500w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=571 571w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=650 650w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=741 741w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=845 845w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=964 964w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=1098 1098w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=1252 1252w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=1428 1428w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/x5RaAqvkC5QOjRWyEVv0.png?auto=format&amp;w=1600 1600w" decoding="async" height="344" loading="lazy" width="800"></figure><p>Even if you only have one tab open to the demo, refreshing the page isn't enough to let the new version take over. This is due to how browser navigations work. When you navigate, the current page doesn't go away until the response headers have been received, and even then the current page may stay if the response has a <code>Content-Disposition</code> header. Because of this overlap, the current service worker is always controlling a client during a refresh.</p><p>To get the update, close or navigate away from all tabs using the current service worker. Then, when you <a href="https://service-worker-lifecycle-demos.glitch.me/main/v2.html" rel="noopener">navigate to the demo again</a>, you should see the horse.</p><p>This pattern is similar to how Chrome updates. Updates to Chrome download in the background, but don't apply until Chrome restarts. In the mean time, you can continue to use the current version without disruption. However, this is a pain during development, but DevTools has ways to make it easier, which I'll cover <a href="https://web.dev/service-worker-lifecycle/#devtools">later in this article</a>.</p><h3 id="activate-2">Activate <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#activate-2">#</a></h3><p>This fires once the old service worker is gone, and your new service worker is able to control clients. This is the ideal time to do stuff that you couldn't do while the old worker was still in use, such as migrating databases and clearing caches.</p><p>In the demo above, I maintain a list of caches that I expect to be there, and in the <code>activate</code> event I get rid of any others, which removes the old <code>static-v1</code> cache.</p><aside class="aside flow bg-state-bad-bg color-state-bad-text"><p class="cluster color-state-bad-text"><span class="aside__icon box-block"><svg aria-label="Error sign" viewBox="0 0 24 24" fill="currentColor" height="24" role="img" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-2h2v2h-2zm0-10v6h2V7h-2z" clip-rule="evenodd" fill-rule="evenodd"></path></svg></span><strong>Caution</strong></p><div class="flow">You may not be updating from the previous version. It may be a service worker many versions old.</div></aside><p>If you pass a promise to <code>event.waitUntil()</code> it'll buffer functional events (<code>fetch</code>, <code>push</code>, <code>sync</code> etc.) until the promise resolves. So when your <code>fetch</code> event fires, the activation is fully complete.</p><aside class="aside flow bg-state-bad-bg color-state-bad-text"><p class="cluster color-state-bad-text"><span class="aside__icon box-block"><svg aria-label="Error sign" viewBox="0 0 24 24" fill="currentColor" height="24" role="img" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-2h2v2h-2zm0-10v6h2V7h-2z" clip-rule="evenodd" fill-rule="evenodd"></path></svg></span><strong>Caution</strong></p><div class="flow">The cache storage API is "origin storage" (like localStorage, and IndexedDB). If you run many sites on the same origin (for example, <code>yourname.github.io/myapp</code>), be careful that you don't delete caches for your other sites. To avoid this, give your cache names a prefix unique to the current site, eg <code>myapp-static-v1</code>, and don't touch caches unless they begin with <code>myapp-</code>.</div></aside><h3 id="skip-the-waiting-phase">Skip the waiting phase <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#skip-the-waiting-phase">#</a></h3><p>The waiting phase means you're only running one version of your site at once, but if you don't need that feature, you can make your new service worker activate sooner by calling <code>self.skipWaiting()</code>.</p><p>This causes your service worker to kick out the current active worker and activate itself as soon as it enters the waiting phase (or immediately if it's already in the waiting phase). It <em>doesn't</em> cause your worker to skip installing, just waiting.</p><p>It doesn't really matter when you call <code>skipWaiting()</code>, as long as it's during or before waiting. It's pretty common to call it in the <code>install</code> event:</p><web-copy-code><button class="button button__round web-copy-code__button" aria-label="Copy code"><span class="tooltip" role="tooltip" data-alignment="left"><span class="tooltip__content">Copy code</span></span></button><pre class="language-js"><code class="language-js">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><br>    <span class="token comment">// caching etc</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <!----></web-copy-code><p>But you may want to call it as a results of a <code>postMessage()</code> to the service worker. As in, you want to <code>skipWaiting()</code> following a user interaction.</p><p><a href="https://service-worker-lifecycle-demos.glitch.me/main/v3.html" rel="noopener">Here's a demo that uses <code>skipWaiting()</code></a>. You should see a picture of a cow without having to navigate away. Like <code>clients.claim()</code> it's a race, so you'll only see the cow if the new service worker fetches, installs and activates before the page tries to load the image.</p><aside class="aside flow bg-state-bad-bg color-state-bad-text"><p class="cluster color-state-bad-text"><span class="aside__icon box-block"><svg aria-label="Error sign" viewBox="0 0 24 24" fill="currentColor" height="24" role="img" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-2h2v2h-2zm0-10v6h2V7h-2z" clip-rule="evenodd" fill-rule="evenodd"></path></svg></span><strong>Caution</strong></p><div class="flow"><code>skipWaiting()</code> means that your new service worker is likely controlling pages that were loaded with an older version. This means some of your page's fetches will have been handled by your old service worker, but your new service worker will be handling subsequent fetches. If this might break things, don't use <code>skipWaiting()</code>.</div></aside><h3 id="manual-updates">Manual updates <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#manual-updates">#</a></h3><p>As I mentioned earlier, the browser checks for updates automatically after navigations and functional events, but you can also trigger them manually:</p><web-copy-code><button class="button button__round web-copy-code__button" aria-label="Copy code"><span class="tooltip" role="tooltip" data-alignment="left"><span class="tooltip__content">Copy code</span></span></button><pre class="language-js"><code class="language-js">navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token comment">// sometime later…</span><br>  reg<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <!----></web-copy-code><p>If you expect the user to be using your site for a long time without reloading, you may want to call <code>update()</code> on an interval (such as hourly).</p><h3 id="avoid-url-change">Avoid changing the URL of your service worker script <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#avoid-url-change">#</a></h3><p>If you've read <a href="https://jakearchibald.com/2016/caching-best-practices/" rel="noopener">my post on caching best practices</a>, you may consider giving each version of your service worker a unique URL. <strong>Don't do this!</strong> This is usually bad practice for service workers, just update the script at its current location.</p><p>It can land you with a problem like this:</p><ol><li><code>index.html</code> registers <code>sw-v1.js</code> as a service worker.</li><li><code>sw-v1.js</code> caches and serves <code>index.html</code> so it works offline-first.</li><li>You update <code>index.html</code> so it registers your new and shiny <code>sw-v2.js</code>.</li></ol><p>If you do the above, the user never gets <code>sw-v2.js</code>, because <code>sw-v1.js</code> is serving the old version of <code>index.html</code> from its cache. You've put yourself in a position where you need to update your service worker in order to update your service worker. Ew.</p><p>However, for <a href="https://service-worker-lifecycle-demos.glitch.me/main/v2.html" rel="noopener">the demo above</a>, I <em>have</em> changed the URL of the service worker. This is so, for the sake of the demo, you can switch between the versions. It isn't something I'd do in production.</p><h2 id="devtools">Making development easy <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#devtools">#</a></h2><p>The service worker lifecycle is built with the user in mind, but during development it's a bit of a pain. Thankfully there are a few tools to help out:</p><h3 id="update-on-reload">Update on reload <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#update-on-reload">#</a></h3><p>This one's my favourite.</p><figure><img alt="DevTools showing &#39;update on reload&#39;" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="./The service worker lifecycle_files/7DmQ1yJvTqjWbBoxh1ud.png" srcset="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=200 200w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=228 228w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=260 260w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=296 296w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=338 338w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=385 385w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=439 439w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=500 500w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=571 571w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=650 650w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=741 741w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=845 845w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=964 964w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=1098 1098w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=1252 1252w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=1428 1428w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/7DmQ1yJvTqjWbBoxh1ud.png?auto=format&amp;w=1600 1600w" decoding="async" height="344" loading="lazy" width="800"></figure><p>This changes the lifecycle to be developer-friendly. Each navigation will:</p><ol><li>Refetch the service worker.</li><li>Install it as a new version even if it's byte-identical, meaning your <code>install</code> event runs and your caches update.</li><li>Skip the waiting phase so the new service worker activates.</li><li>Navigate the page.</li></ol><p>This means you'll get your updates on each navigation (including refresh) without having to reload twice or close the tab.</p><h3 id="skip-waiting">Skip waiting <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#skip-waiting">#</a></h3><figure><img alt="DevTools showing &#39;skip waiting&#39;" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="./The service worker lifecycle_files/JkYj44hXCg4CM8dgdbKE.png" srcset="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=200 200w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=228 228w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=260 260w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=296 296w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=338 338w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=385 385w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=439 439w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=500 500w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=571 571w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=650 650w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=741 741w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=845 845w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=964 964w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=1098 1098w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=1252 1252w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=1428 1428w,     https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/JkYj44hXCg4CM8dgdbKE.png?auto=format&amp;w=1600 1600w" decoding="async" height="344" loading="lazy" width="800"></figure><p>If you have a worker waiting, you can hit "skip waiting" in DevTools to immediately promote it to "active".</p><h3 id="shift-reload">Shift-reload <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#shift-reload">#</a></h3><p>If you force-reload the page (shift-reload) it bypasses the service worker entirely. It'll be uncontrolled. This feature is in the spec, so it works in other service-worker-supporting browsers.</p><h2 id="handling-updates">Handling updates <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#handling-updates">#</a></h2><p>The service worker was designed as part of the <a href="https://extensiblewebmanifesto.org/" rel="noopener">extensible web</a>. The idea is that we, as browser developers, acknowledge that we are not better at web development than web developers. And as such, we shouldn't provide narrow high-level APIs that solve a particular problem using patterns <em>we</em> like, and instead give you access to the guts of the browser and let you do it how you want, in a way that works best for <em>your</em> users.</p><p>So, to enable as many patterns as we can, the whole update cycle is observable:</p><web-copy-code><button class="button button__round web-copy-code__button" aria-label="Copy code"><span class="tooltip" role="tooltip" data-alignment="left"><span class="tooltip__content">Copy code</span></span></button><pre class="language-js"><code class="language-js">navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  reg<span class="token punctuation">.</span>installing<span class="token punctuation">;</span> <span class="token comment">// the installing worker, or undefined</span><br>  reg<span class="token punctuation">.</span>waiting<span class="token punctuation">;</span> <span class="token comment">// the waiting worker, or undefined</span><br>  reg<span class="token punctuation">.</span>active<span class="token punctuation">;</span> <span class="token comment">// the active worker, or undefined</span><br><br>  reg<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'updatefound'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    <span class="token comment">// A wild service worker has appeared in reg.installing!</span><br>    <span class="token keyword">const</span> newWorker <span class="token operator">=</span> reg<span class="token punctuation">.</span>installing<span class="token punctuation">;</span><br><br>    newWorker<span class="token punctuation">.</span>state<span class="token punctuation">;</span><br>    <span class="token comment">// "installing" - the install event has fired, but not yet complete</span><br>    <span class="token comment">// "installed"  - install complete</span><br>    <span class="token comment">// "activating" - the activate event has fired, but not yet complete</span><br>    <span class="token comment">// "activated"  - fully active</span><br>    <span class="token comment">// "redundant"  - discarded. Either failed install, or it's been</span><br>    <span class="token comment">//                replaced by a newer version</span><br><br>    newWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'statechange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>      <span class="token comment">// newWorker.state has changed</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'controllerchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token comment">// This fires when the service worker controlling this page</span><br>  <span class="token comment">// changes, eg a new worker has skipped waiting and become</span><br>  <span class="token comment">// the new active worker.</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <!----></web-copy-code><h2 id="the-lifecycle-goes-ever-on">The lifecycle goes ever on <a class="headline-link" href="https://web.dev/service-worker-lifecycle/#the-lifecycle-goes-ever-on">#</a></h2><p>As you can see, it pays to understand the service worker lifecycle—and with that understanding, service worker behaviors should seem more logical, and less mysterious. That knowledge will give you more confidence as you deploy and update service workers.</p><nav class="cluster gutter-base flow-space-size-2" aria-label="tags"><a class="pill" href="https://web.dev/tags/javascript/">JavaScript</a><a class="pill" href="https://web.dev/tags/install/">Install</a><a class="pill" href="https://web.dev/tags/offline/">Offline</a><a class="pill" href="https://web.dev/tags/progressive-web-apps/">Progressive Web Apps</a><a class="pill" href="https://web.dev/tags/service-worker/">Service Worker</a></nav><div class="post-credits"><div><h3>Last updated</h3><span> <time>Dec 5, 2018</time> </span> — <a href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/reliable/service-worker-lifecycle/index.md"> Improve article </a></div></div><div class="flow-space-size-2"><a class="button" data-type="secondary" href="https://web.dev/reliable"> <svg viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg> <span>Return to all articles</span> </a></div><div class="docked-actions flow flow-space-base"><div><share-action class="gc-analytics-event fab" authors="@jaffathecake" data-action="click" data-category="web.dev" data-icon="share" data-label="share, twitter" data-type="primary" role="button" tabindex="0"> <svg viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M18 16.1c-.8 0-1.4.3-2 .8l-7.1-4.2c.1-.2.1-.5.1-.7s0-.5-.1-.7L16 7.2c.5.5 1.2.8 2 .8 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .2 0 .5.1.7L8 9.8C7.5 9.3 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.1 4.2c-.1.2-.1.4-.1.6 0 1.6 1.3 2.9 2.9 2.9s2.9-1.3 2.9-2.9-1.2-2.9-2.8-2.9z" fill="currentColor"></path></svg> <span class="fab__label">Share</span> </share-action></div><div><a class="fab gc-analytics-event" data-action="click" data-category="web.dev" data-label="view-subscribe" data-type="primary" href="https://web.dev/newsletter/"> <svg aria-label="An envelope with plus icon" viewBox="0 0 24 24" height="24" role="img" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20H4c-1.1 0-2-.9-2-2l.01-12c0-1.1.89-2 1.99-2h16c1.1 0 2 .9 2 2v7h-2V8l-8 5-8-5v10h9v2zm-1-9l8-5H4l8 5zm8 7h3v2h-3v3h-2v-3h-3v-2h3v-3h2v3z" fill="currentColor" fill-rule="nonzero"></path></svg> <span class="fab__label">subscribe</span> </a></div></div></article></div></div></main><footer class="site-footer" role="contentinfo"><nav aria-label="footer navigation" class="site-footer__primary-nav auto-grid"><div class="site-footer__primary-nav-content"><a class="site-footer__brand brand" href="https://web.dev/"> <svg viewBox="0 0 125 24" aria-label="web.dev" fill="currentColor" height="24" role="img" width="125" xmlns="http://www.w3.org/2000/svg"><path d="M0.625 19.9489C0.625 18.2638 1.99102 16.8977 3.67614 16.8977H19.9489C21.634 16.8977 23 18.2638 23 19.9489C23 21.634 21.634 23 19.9489 23H3.67614C1.99102 23 0.625 21.634 0.625 19.9489Z" fill="#66CCFF"></path><path d="M1.51866 1.51866C2.7102 0.327114 4.64208 0.327114 5.83361 1.51866L13.97 9.65503C15.1615 10.8466 15.1615 12.7784 13.97 13.97L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L7.13797 12.1721C7.33655 11.9735 7.33655 11.6515 7.13797 11.4529L1.51866 5.83361C0.327114 4.64208 0.327114 2.7102 1.51866 1.51866Z" clip-rule="evenodd" fill="#0066FF" fill-rule="evenodd"></path><path d="M11.0422 16.8977L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L2.41233 16.8977H11.0422Z" fill="#CC66FF"></path><path d="M19.9488 23C21.6339 23 23 21.634 23 19.9489C23 18.2638 21.6339 16.8977 19.9488 16.8977C18.2637 16.8977 16.8977 18.2638 16.8977 19.9489C16.8977 21.634 18.2637 23 19.9488 23Z" fill="#0066FF"></path><path d="M116.6 20.1H114.4L109.6 8.20005H112L115.5 17.4L119 8.20005H121.4L116.6 20.1V20.1ZM99.8 12.8H106.6C106.5 11.2 105.2 9.90005 103.2 9.90005C101.5 9.90005 100.2 11 99.8 12.8V12.8ZM103.4 20.5C99.9 20.5 97.4 17.8 97.4 14.2C97.4 10.6 99.9 7.90005 103.3 7.90005C106.8 7.90005 109.1 10.3 109.1 14.4V14.6H99.8C99.9 16.9 101.6 18.5 103.6 18.5C105 18.5 106.2 17.8 106.9 16.4L108.9 17.4C107.8 19.3 105.8 20.5 103.4 20.5V20.5ZM89.4 20.5C86.3 20.5 83.7 17.7 83.7 14.2C83.7 10.7 86.3 7.90005 89.4 7.90005C91.1 7.90005 92.7 8.70005 93.5 9.90005H93.6L93.5 8.30005V2.80005H95.7V20.1H93.6V18.5H93.5C92.6 19.7 91.1 20.5 89.4 20.5V20.5ZM89.7 18.5C91.9 18.5 93.5 16.8 93.5 14.2C93.5 11.7 91.9 9.90005 89.7 9.90005C87.6 9.90005 85.9 11.7 85.9 14.2C85.9 16.7 87.6 18.5 89.7 18.5ZM82.9 18.6C82.9 19.5 82.2 20.2001 81.2 20.2001C80.3 20.2001 79.5 19.4 79.5 18.6C79.5 17.7 80.3 17 81.2 17C82.2 17 82.9 17.7 82.9 18.6ZM72.4 18.5C74.5 18.5 76.2 16.7 76.2 14.2C76.2 11.7 74.5 9.90005 72.4 9.90005C70.2 9.90005 68.6 11.7 68.6 14.2C68.6 16.7 70.2 18.5 72.4 18.5ZM72.8 20.5C71.1 20.5 69.5 19.7 68.7 18.5H68.6V20.1H66.5V2.80005H68.7V8.30005L68.6 9.90005H68.7C69.5 8.70005 71 7.90005 72.8 7.90005C75.9 7.90005 78.5 10.7 78.5 14.2C78.4 17.7 75.9 20.5 72.8 20.5V20.5ZM55.4 12.8H62.2C62.1 11.2 60.8 9.90005 58.8 9.90005C57.1 9.90005 55.8 11 55.4 12.8V12.8ZM59 20.5C55.5 20.5 53 17.8 53 14.2C53 10.6 55.5 7.90005 58.9 7.90005C62.4 7.90005 64.7 10.3 64.7 14.4V14.6H55.4C55.5 16.9 57.2 18.5 59.2 18.5C60.6 18.5 61.7 17.8 62.5 16.4L64.5 17.4C63.4 19.3 61.4 20.5 59 20.5V20.5ZM52.7 8.30005L48.9 20.2001H46.6L43.6 11.1L40.7 20.2001H38.4L34.5 8.30005H36.8L39.4 17.3L42.3 8.30005H44.6L47.5 17.3L50.1 8.30005H52.7V8.30005Z" clip-rule="evenodd" fill-rule="evenodd"></path></svg> </a><p class="text-size-0">We want to help you build beautiful, accessible, fast, and secure websites that work cross-browser, and for all of your users. This site is our home for content to help you on that journey, written by members of the Chrome team, and external experts.</p></div><div class="site-footer__primary-nav-links auto-grid"><div><h3 class="text-size-2 color-mid-text">Contribute</h3><ul class="site-footer__linkbox-list" role="list"><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&amp;labels=bug&amp;template=bug_report.md&amp;title="> File a bug </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)" href="https://github.com/googlechrome/web.dev"> View source </a></li></ul></div><div><h3 class="text-size-2 color-mid-text">Related content</h3><ul class="site-footer__linkbox-list" role="list"><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href="https://developer.chrome.com/"> developer.chrome.com </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href="https://blog.chromium.org/"> Chrome updates </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)" href="https://web.dev/tags/case-study/"> Case studies </a></li><li><a data-label="Footer Link (index 5)" data-category="Podcasts" href="https://web.dev/podcasts/"> Podcasts </a></li><li><a data-label="Footer Link (index 6)" data-category="Shows" href="https://web.dev/shows/"> Shows </a></li></ul></div><div><h3 class="text-size-2 color-mid-text">Connect</h3><ul class="site-footer__linkbox-list" role="list"><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href="https://www.twitter.com/ChromiumDev"> Twitter </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)" href="https://www.youtube.com/user/ChromeDevelopers"> YouTube </a></li></ul></div></div></nav><nav aria-label="Google developers" class="site-footer__brand-nav repel"><ul class="cluster" role="list"><li><a data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link" href="https://developers.google.com/"> <img alt="Google Developers" class="site-footer__utility-logo" height="33" loading="lazy" src="./The service worker lifecycle_files/lockup-color.png" width="185"> </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Chrome Link" href="https://developer.chrome.com/"> Chrome </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Firebase Link" href="https://firebase.google.com/"> Firebase </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Google Cloud Platform Link" href="https://cloud.google.com/"> Google Cloud Platform </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer All products Link" href="https://developers.google.com/products"> All products </a></li></ul><div class="cluster"><theme-toggle> <label class="toggle-switch" for="theme-toggle"><span class="toggle-switch__label">Dark theme</span> <input class="toggle-switch__input" id="theme-toggle" role="switch" type="checkbox"> <div class="toggle-switch__decor focus-ring" aria-hidden="true"><div class="toggle-switch__thumb"></div></div></label> </theme-toggle><web-language-select current="en"><!---->
      <div class="w-display-flex">
        <label class="visually-hidden" for="preferred-language">
          Choose language
        </label>
        <select id="preferred-language">
          <!--?lit$215705122$--><!---->
          <option selected="" value="en">
            <!--?lit$215705122$-->ENGLISH (<!--?lit$215705122$-->en)
          </option>
        <!---->
        </select>
      </div>
    </web-language-select></div></nav><nav aria-label="terms and policies" class="site-footer__misc-links"><ul class="cluster" role="list"><li><a data-category="Site-Wide Custom Events" data-label="Footer Terms and Privacy link" href="https://policies.google.com/"> Terms &amp; Privacy </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Community Guidelines link" href="https://web.dev/community-guidelines/"> Community Guidelines </a></li></ul></nav><p class="gap-top-size-2 text-size-0">Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/"> Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/terms/site-policies"> Google Developers Site Policies</a>.</p></footer><web-devrel-ribbon class="devrel-ribbon"> <a class="devrel-ribbon__ribbon bg-floating-ribbon-bg" href="https://web.dev/about/"> <span>By</span> <svg viewBox="0 0 24 24" fill="none" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12.0002 0.000198896C8.03654 0.000198896 4.52717 1.9163 2.34307 4.87283L6.04945 11.2927C6.22181 9.848 6.91291 8.51514 7.99463 7.54208C9.07636 6.56901 10.4747 6.0223 11.9296 6.00331C11.9529 6.00073 11.9767 5.99962 12.0005 5.99981L22.3939 5.99981C20.3207 2.41237 16.4471 0.000198896 12.0002 0.000198896ZM1.60671 5.99906C0.586498 7.76412 0 9.81226 0 12.0003C0 18.1811 4.65658 23.2593 10.6575 23.9249L14.3581 17.5155C13.6129 17.8346 12.8109 17.9998 12.0001 18.0003C9.89088 17.9976 7.93796 16.8875 6.85643 15.0765C6.83691 15.0526 6.81923 15.027 6.80376 15.0003L1.60671 5.99906ZM12.0002 7.20025C10.7271 7.20025 9.50625 7.70609 8.60612 8.60622C7.70598 9.50636 7.20033 10.7273 7.20033 12.0003C7.20033 13.2733 7.70603 14.4942 8.60612 15.3943C9.50621 16.2945 10.7271 16.8001 12.0002 16.8001C13.2732 16.8001 14.4941 16.2944 15.3942 15.3943C16.2944 14.4943 16.8 13.2733 16.8 12.0003C16.8 10.7273 16.2943 9.50636 15.3942 8.60622C14.4941 7.70609 13.2732 7.20025 12.0002 7.20025ZM15.5902 7.20025C17.1048 8.33129 17.9977 10.11 18.0001 12.0003C17.9977 13.0181 17.7364 14.0185 17.2409 14.9076C17.2289 14.9397 17.2142 14.9706 17.1969 15.0003L12.0009 24.0002C18.6352 23.9998 24 18.6345 24 12.0001C24 10.2923 23.6427 8.66976 23.0015 7.2001L15.5902 7.20025Z" fill="white"></path></svg> <span>Chrome DevRel</span> </a> <!----></web-devrel-ribbon><iframe title="Private Aggregation API Test" src="./The service worker lifecycle_files/private-aggregation-test.html" style="height: 0px; width: 0px; top: 0px; position: absolute;"></iframe></body></html>